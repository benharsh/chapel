#!/usr/bin/env python3

import subprocess, sys

def genDyno(name):
    dotChpl = name + ".chpl"
    dotDyno = name + ".chpl.dyno"
    subprocess.run([sys.argv[3], "testGenLib.chpl", "--dyno-gen-lib", dotChpl])

    f = open(dotDyno, "r+b")
    data = f.read()

    # Note: length of strings must match.
    prefix = b'MYPREFIX: '
    tmp = " ".join([name, name, name])
    needle = bytes(tmp, 'utf-8')
    rn = name[::-1]
    reverse = bytes("-".join([rn, rn, rn]), 'utf-8')
    updated = data.replace(prefix + needle, prefix + reverse)

    f.seek(0)
    f.write(updated)
    f.flush()

genDyno("MyMod")
genDyno("OtherMod")
